<?php

/**
 * @file
 * Contains sp_field.module.
 */

use Drupal\Core\Routing\RouteMatchInterface;
use Drupal\sp_create\PlanYearInfo;
use Drupal\Core\Entity\EntityInterface;
use Drupal\Core\Entity\Display\EntityViewDisplayInterface;

/**
 * Implements hook_help().
 */
function sp_field_help($route_name, RouteMatchInterface $route_match) {
  switch ($route_name) {
    // Main module help for the sp_field module.
    case 'help.page.sp_field':
      $output = '';
      $output .= '<h3>' . t('About') . '</h3>';
      $output .= '<p>' . t('Alter or create fields on the site.') . '</p>';
      return $output;

    default:
  }
}

/**
 * Implements hook_entity_extra_field_info().
 */
function sp_field_entity_extra_field_info() {
  $extra = [];
  $extra['node'][PlanYearInfo::SPY_BUNDLE]['display']['plan_type_badge'] = [
    'label' => t('Plan Type Badge'),
    'description' => t('Shows whether or not this is a combined plan or unified plan.'),
    'weight' => 99,
    'visible' => TRUE,
  ];
  $extra['node'][PlanYearInfo::SPY_BUNDLE]['display']['plan_year_view'] = [
    'label' => t('View a plan year'),
    'description' => t('Allows the display of an entire plan year.'),
    'weight' => 100,
    'visible' => TRUE,
  ];
  $extra['node'][PlanYearInfo::SPY_BUNDLE]['display']['plan_year_toc'] = [
    'label' => t('View a plan year TOC'),
    'description' => t('Allows the display of a plan year table of contents.'),
    'weight' => 101,
    'visible' => TRUE,
  ];
  $extra['node'][PlanYearInfo::SPYS_BUNDLE]['display']['plan_year_section_view'] = [
    'label' => t('View a plan year section'),
    'description' => t('Allows the display of a plan year section.'),
    'weight' => 101,
    'visible' => TRUE,
  ];
  $extra['node']['homepage']['display']['download_plan_form_vertical'] = [
    'label' => t('Download a State Plan - Vertical'),
    'description' => t('Allows users to filter and download state plans.'),
    'weight' => 100,
    'visible' => TRUE,
  ];
  $extra['node']['homepage']['display']['download_plan_form_horizontal'] = [
    'label' => t('Download a State Plan - Horizontal'),
    'description' => t('Allows users to filter and download state plans.'),
    'weight' => 101,
    'visible' => TRUE,
  ];

  return $extra;
}

/**
 * Implements hook_ENTITY_TYPE_view().
 */
function sp_field_node_view(array &$build, EntityInterface $entity, EntityViewDisplayInterface $display, $view_mode) {
  if ($display->getComponent('plan_type_badge')) {
    $build['plan_type_badge'] = [
      '#theme' => 'sp_display_plan_type_badge',
      '#node' => $entity,
    ];
  }
  if ($display->getComponent('plan_year_view')) {
    $build['plan_year_view'] = [
      '#theme' => 'sp_display_plan_year_view',
      '#node' => $entity,
    ];
  }
  if ($display->getComponent('plan_year_toc')) {
    $build['plan_year_toc'] = [
      '#theme' => 'sp_display_plan_year_toc',
      '#node' => $entity,
    ];
  }
  if ($display->getComponent('plan_year_section_view')) {
    $build['plan_year_section_view'] = [
      '#theme' => 'sp_display_plan_year_section_view',
      '#node' => $entity,
    ];
  }
  if ($display->getComponent('download_plan_form_vertical')) {
    $build['download_plan_form_vertical'] = [
      '#theme' => 'sp_display_download_plan_form',
      '#orientation' => 'vertical',
    ];
  }
  if ($display->getComponent('download_plan_form_horizontal')) {
    $build['download_plan_form_horizontal'] = [
      '#theme' => 'sp_display_download_plan_form',
      '#node' => $entity,
      '#orientation' => 'horizontal',
    ];
  }
}
